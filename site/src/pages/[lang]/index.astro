---
import Layout from '../../layouts/Layout.astro'
import Hero from '../../components/Hero.astro'
import AdSense from '../../components/AdSense.astro'
import ArticleCard from '../../components/ArticleCard.astro'
import SearchFilter from '../../components/SearchFilter.astro'
import { getArticles, type Article } from '../../lib/sanity'
import { ENABLED_LANGUAGES, getUILabel } from '../../lib/i18n'

export async function getStaticPaths() {
  // æ—¥æœ¬èªä»¥å¤–ã®æœ‰åŠ¹ãªè¨€èªã®ãƒ‘ã‚¹ã‚’ç”Ÿæˆ
  const paths = ENABLED_LANGUAGES
    .filter(lang => lang.id !== 'ja')
    .map(lang => ({
      params: { lang: lang.id }
    }))
  
  return paths
}

const { lang } = Astro.params

let articles: Article[] = []
try {
  articles = await getArticles(lang)
} catch (error) {
  console.error('Failed to fetch articles:', error)
}
---

<Layout 
  title={`${getUILabel(lang, 'siteTitle')} - ${getUILabel(lang, 'siteDescription')}`}
  description={getUILabel(lang, 'siteDescription')}
  lang={lang}
>
  <!-- Hero Section -->
  <Hero lang={lang} />

  <div class="max-w-7xl mx-auto px-4 py-16 space-y-16">
    <!-- Search and Filter Section -->
    <SearchFilter lang={lang} />
    
    <!-- Articles Section -->
    <section id="articles" class="relative">
      
      {articles.length === 0 ? (
        <div class="text-center py-16 bg-white rounded-2xl shadow-lg border border-gray-100">
          <div class="text-6xl mb-4">ğŸ“</div>
          <p class="text-gray-500 text-xl mb-2">
            {lang === 'en' ? 'No articles yet' : 
             lang === 'zh-cn' ? 'æš‚æ— æ–‡ç« ' :
             lang === 'zh-tw' ? 'æš«ç„¡æ–‡ç« ' :
             lang === 'ko' ? 'ì•„ì§ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤' :
             'No articles yet'}
          </p>
          <p class="text-gray-400">
            {lang === 'en' ? 'Please create your first article in Sanity Studio' :
             lang === 'zh-cn' ? 'è¯·åœ¨ Sanity Studio ä¸­åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ç¯‡æ–‡ç« ' :
             lang === 'zh-tw' ? 'è«‹åœ¨ Sanity Studio ä¸­å‰µå»ºæ‚¨çš„ç¬¬ä¸€ç¯‡æ–‡ç« ' :
             lang === 'ko' ? 'Sanity Studioì—ì„œ ì²« ë²ˆì§¸ ê¸°ì‚¬ë¥¼ ì‘ì„±í•˜ì„¸ìš”' :
             'Please create your first article in Sanity Studio'}
          </p>
        </div>
      ) : (
        <div class="columns-1 sm:columns-2 lg:columns-3 gap-6">
          {articles.map((article) => (
            <ArticleCard article={article} lang={lang} />
          ))}
        </div>
      )}
    </section>

    <!-- Google AdSense åºƒå‘Š -->
    <AdSense 
      slot="homepage-bottom"
      format="banner"
      lang={lang}
      className="mt-16"
    />
  </div>
</Layout>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>