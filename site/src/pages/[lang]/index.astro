---
import Layout from '../../layouts/Layout.astro'
import Hero from '../../components/Hero.astro'
import ArticleCard from '../../components/ArticleCard.astro'
import { getArticles } from '../../lib/sanity'
import { ENABLED_LANGUAGES, DEFAULT_LANGUAGE, getLanguageInfo, isLanguageEnabled } from '../../lib/i18n'

export async function getStaticPaths() {
  // Phase 1ã®7è¨€èªã®ã¿ç”Ÿæˆï¼ˆæ—¥æœ¬èªä»¥å¤–ï¼‰
  const paths = ENABLED_LANGUAGES
    .filter(lang => lang.id !== DEFAULT_LANGUAGE) // æ—¥æœ¬èªã¯ /index.astro ã§å‡¦ç†
    .map(lang => ({
      params: { lang: lang.id }
    }))
  
  return paths
}

const { lang } = Astro.params

// è¨€èªæ¤œè¨¼
if (!lang || !isLanguageEnabled(lang)) {
  return Astro.redirect('/')
}

const languageInfo = getLanguageInfo(lang)!

// è¨˜äº‹ãƒ‡ãƒ¼ã‚¿å–å¾—
let articles: any[] = []
try {
  articles = await getArticles(lang)
} catch (error) {
  console.error(`Failed to fetch articles for language ${lang}:`, error)
}

// ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«ã¨ãƒ¡ã‚¿æƒ…å ±
const getLocalizedContent = (lang: string) => {
  const content = {
    ja: {
      title: "æ—…ãƒ­ã‚° - æ—¥æœ¬å…¨å›½ã®æ—…è¨˜éŒ²",
      description: "æ—¥æœ¬å…¨å›½ã®æ—…ãƒ­ã‚°ã‚’å¤šè¨€èªã§ç™ºä¿¡ã™ã‚‹ãƒ–ãƒ­ã‚°ã€‚å„åœ°ã®é­…åŠ›ã‚’å†™çœŸã¨æ–‡ç« ã§ãŠå±Šã‘ã—ã¾ã™ã€‚",
      noArticles: "ã¾ã è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“",
      createFirst: "Sanity Studio ã§æœ€åˆã®è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„"
    },
    en: {
      title: "Travel Log - Japan Travel Stories",
      description: "Multilingual travel blog featuring stories from across Japan. Discover hidden gems and must-visit destinations.",
      noArticles: "No articles yet",
      createFirst: "Create your first article in Sanity Studio"
    },
    "zh-cn": {
      title: "æ—…è¡Œæ—¥å¿— - æ—¥æœ¬å…¨å›½æ—…è¡Œæ•…äº‹",
      description: "å¤šè¯­è¨€æ—…è¡Œåšå®¢ï¼Œä»‹ç»æ—¥æœ¬å„åœ°çš„æ—…è¡Œæ•…äº‹ã€‚å‘ç°éšè—çš„å®çŸ³å’Œå¿…æ¸¸ç›®çš„åœ°ã€‚",
      noArticles: "æš‚æ— æ–‡ç« ",
      createFirst: "è¯·åœ¨ Sanity Studio ä¸­åˆ›å»ºç¬¬ä¸€ç¯‡æ–‡ç« "
    },
    "zh-tw": {
      title: "æ—…è¡Œæ—¥èªŒ - æ—¥æœ¬å…¨åœ‹æ—…è¡Œæ•…äº‹",
      description: "å¤šèªè¨€æ—…è¡Œéƒ¨è½æ ¼ï¼Œä»‹ç´¹æ—¥æœ¬å„åœ°çš„æ—…è¡Œæ•…äº‹ã€‚ç™¼ç¾éš±è—çš„å¯¶çŸ³å’Œå¿…éŠç›®çš„åœ°ã€‚",
      noArticles: "æš«ç„¡æ–‡ç« ",
      createFirst: "è«‹åœ¨ Sanity Studio ä¸­å‰µå»ºç¬¬ä¸€ç¯‡æ–‡ç« "
    },
    ko: {
      title: "ì—¬í–‰ ë¡œê·¸ - ì¼ë³¸ ì „êµ­ ì—¬í–‰ ì´ì•¼ê¸°",
      description: "ì¼ë³¸ ì „êµ­ì˜ ì—¬í–‰ ì´ì•¼ê¸°ë¥¼ ë‹¤êµ­ì–´ë¡œ ì „í•˜ëŠ” ë¸”ë¡œê·¸. ìˆ¨ê²¨ì§„ ë³´ì„ê³¼ ê¼­ ê°€ë´ì•¼ í•  ëª©ì ì§€ë¥¼ ë°œê²¬í•˜ì„¸ìš”.",
      noArticles: "ì•„ì§ ê¸°ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤",
      createFirst: "Sanity Studioì—ì„œ ì²« ë²ˆì§¸ ê¸°ì‚¬ë¥¼ ì‘ì„±í•˜ì„¸ìš”"
    },
    th: {
      title: "à¸šà¸¥à¹‡à¸­à¸à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡ - à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸²à¸§à¸à¸²à¸£à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¸—à¸±à¹ˆà¸§à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™",
      description: "à¸šà¸¥à¹‡à¸­à¸à¸—à¹ˆà¸­à¸‡à¹€à¸—à¸µà¹ˆà¸¢à¸§à¸«à¸¥à¸²à¸¢à¸ à¸²à¸©à¸²à¸—à¸µà¹ˆà¸™à¸³à¹€à¸ªà¸™à¸­à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸²à¸§à¸ˆà¸²à¸à¸—à¸±à¹ˆà¸§à¸à¸µà¹ˆà¸›à¸¸à¹ˆà¸™ à¸„à¹‰à¸™à¸à¸šà¸­à¸±à¸à¸¡à¸“à¸µà¸—à¸µà¹ˆà¸‹à¹ˆà¸­à¸™à¸­à¸¢à¸¹à¹ˆà¹à¸¥à¸°à¸ˆà¸¸à¸”à¸«à¸¡à¸²à¸¢à¸›à¸¥à¸²à¸¢à¸—à¸²à¸‡à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¹€à¸¢à¸µà¹ˆà¸¢à¸¡à¸Šà¸¡",
      noArticles: "à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸šà¸—à¸„à¸§à¸²à¸¡",
      createFirst: "à¸ªà¸£à¹‰à¸²à¸‡à¸šà¸—à¸„à¸§à¸²à¸¡à¹à¸£à¸à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹ƒà¸™ Sanity Studio"
    },
    vi: {
      title: "Nháº­t kÃ½ Du lá»‹ch - CÃ¢u chuyá»‡n Du lá»‹ch Nháº­t Báº£n",
      description: "Blog du lá»‹ch Ä‘a ngÃ´n ngá»¯ giá»›i thiá»‡u nhá»¯ng cÃ¢u chuyá»‡n tá»« kháº¯p Nháº­t Báº£n. KhÃ¡m phÃ¡ nhá»¯ng viÃªn ngá»c áº©n vÃ  Ä‘iá»ƒm Ä‘áº¿n pháº£i ghÃ© thÄƒm.",
      noArticles: "ChÆ°a cÃ³ bÃ i viáº¿t nÃ o",
      createFirst: "Táº¡o bÃ i viáº¿t Ä‘áº§u tiÃªn cá»§a báº¡n trong Sanity Studio"
    }
  }
  
  return content[lang as keyof typeof content] || content.en
}

const localizedContent = getLocalizedContent(lang)
---

<Layout 
  title={localizedContent.title}
  description={localizedContent.description}
  lang={lang}
>
  <!-- Hero Section -->
  <Hero lang={lang} />

  <div class="max-w-7xl mx-auto px-4 py-16 space-y-16">
    <!-- Articles Section -->
    <section id="articles" class="relative">
      <!-- Background decoration -->
      <div class="absolute top-0 left-1/2 transform -translate-x-1/2 w-px h-20 bg-gradient-to-b from-brand-400 to-transparent"></div>
      
      <div class="text-center mb-16">
        <div class="inline-flex items-center gap-2 px-4 py-2 bg-gradient-to-r from-brand-50 to-accent-50 rounded-full text-brand-700 text-sm font-semibold mb-6 border border-brand-200/50">
          <div class="w-2 h-2 bg-brand-500 rounded-full animate-pulse"></div>
          <span>{languageInfo.nativeName}</span>
        </div>
        
        <h2 class="text-4xl md:text-5xl font-black text-transparent bg-clip-text bg-gradient-to-r from-gray-900 via-brand-600 to-accent-600 mb-6 tracking-tight">
          {lang === 'en' ? 'Latest Stories' : 
           lang === 'zh-cn' ? 'æœ€æ–°æ•…äº‹' :
           lang === 'zh-tw' ? 'æœ€æ–°æ•…äº‹' :
           lang === 'ko' ? 'ìµœì‹  ì´ì•¼ê¸°' :
           lang === 'th' ? 'à¹€à¸£à¸·à¹ˆà¸­à¸‡à¸£à¸²à¸§à¸¥à¹ˆà¸²à¸ªà¸¸à¸”' :
           lang === 'vi' ? 'CÃ¢u chuyá»‡n má»›i nháº¥t' :
           'æœ€æ–°è¨˜äº‹'}
        </h2>
        
        <p class="text-lg md:text-xl text-gray-600 max-w-2xl mx-auto leading-relaxed font-medium">
          {localizedContent.description}
        </p>
      </div>

      {articles.length > 0 ? (
        <div class="columns-1 md:columns-2 lg:columns-3 gap-6 space-y-6">
          {articles.map((article) => (
            <ArticleCard article={article} lang={lang} />
          ))}
        </div>
      ) : (
        <div class="text-center py-16 bg-white rounded-2xl shadow-lg border border-gray-100">
          <div class="text-6xl mb-4">ğŸ“</div>
          <p class="text-gray-500 text-xl mb-2">{localizedContent.noArticles}</p>
          <p class="text-gray-400">{localizedContent.createFirst}</p>
        </div>
      )}
    </section>
  </div>
</Layout>