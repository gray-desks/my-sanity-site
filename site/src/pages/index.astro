---
import Layout from '../layouts/Layout.astro'
import Hero from '../components/Hero.astro'
import AdSlot from '../components/AdSlot.astro'
import ArticleCard from '../components/ArticleCard.astro'
import SearchFilter from '../components/SearchFilter.astro'
import { getArticles, type Article } from '../lib/sanity'

let articles: Article[] = []
try {
  articles = await getArticles()
} catch (error) {
  console.error('Failed to fetch articles:', error)
}
---

<Layout 
  title="æ—…ãƒ­ã‚° - æ—¥æœ¬å…¨å›½ã®æ—…è¨˜éŒ²" 
  description="æ—¥æœ¬å…¨å›½ã®æ—…ãƒ­ã‚°ã‚’å¤šè¨€èªã§ç™ºä¿¡ã™ã‚‹ãƒ–ãƒ­ã‚°ã€‚å„åœ°ã®é­…åŠ›ã‚’å†™çœŸã¨æ–‡ç« ã§ãŠå±Šã‘ã—ã¾ã™ã€‚"
  lang="ja"
  frontmatter={{
    title: "æ—…ãƒ­ã‚° - æ—¥æœ¬å…¨å›½ã®æ—…è¨˜éŒ²",
    description: "æ—¥æœ¬å…¨å›½ã®æ—…ãƒ­ã‚°ã‚’å¤šè¨€èªã§ç™ºä¿¡ã™ã‚‹ãƒ–ãƒ­ã‚°ã€‚å„åœ°ã®é­…åŠ›ã‚’å†™çœŸã¨æ–‡ç« ã§ãŠå±Šã‘ã—ã¾ã™ã€‚",
    lang: "ja"
  }}
>
  <!-- Hero Section -->
  <Hero lang="ja" />

  <!-- Top Ad - Heroç›´ä¸‹ -->
  <div class="max-w-7xl mx-auto px-4 pt-8">
    <AdSlot
      slotId="1234567890"
      format="horizontal" 
      reserveHeight={120}
      label="åºƒå‘Š"
      class="mb-8"
    />
  </div>

  <div class="max-w-7xl mx-auto px-4 py-8 space-y-16">
    <!-- Search and Filter Section -->
    <SearchFilter lang="ja" />
    
    <!-- Articles Section with In-Feed Ads -->
    <section id="articles" class="relative">
      {articles.length === 0 ? (
        <div class="text-center py-16 bg-white rounded-2xl shadow-lg border border-gray-100">
          <div class="text-6xl mb-4">ğŸ“</div>
          <p class="text-gray-500 text-xl mb-2">ã¾ã è¨˜äº‹ãŒã‚ã‚Šã¾ã›ã‚“</p>
          <p class="text-gray-400">Sanity Studio ã§æœ€åˆã®è¨˜äº‹ã‚’ä½œæˆã—ã¦ãã ã•ã„</p>
        </div>
      ) : (
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {articles.map((article, index) => (
            <>
              <ArticleCard article={article} lang="ja" />
              {/* In-feed ads every 4 articles */}
              {(index + 1) % 4 === 0 && index < articles.length - 1 && (
                <div class="col-span-1 md:col-span-2 lg:col-span-3">
                  <AdSlot
                    slotId="2345678901"
                    format="in-feed"
                    reserveHeight={200}
                    label="åºƒå‘Š"
                    class="bg-white rounded-2xl shadow-lg border border-gray-100 p-6"
                  />
                </div>
              )}
            </>
          ))}
        </div>
      )}
    </section>

    <!-- Bottom Ad - ãƒ•ãƒƒã‚¿ãƒ¼ç›´å‰ -->
    <AdSlot
      slotId="3456789012"
      format="horizontal"
      reserveHeight={120}
      label="åºƒå‘Š"
      class="mt-16"
    />
  </div>
</Layout>

<style>
  .line-clamp-3 {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }
</style>
