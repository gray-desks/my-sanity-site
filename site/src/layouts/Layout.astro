---
import '../styles/global.css'
import Navbar from '../components/Navbar.astro'
import Logo from '../components/ui/Logo.astro'
import HreflangLinks from '../components/HreflangLinks.astro'
import Seo from '../components/Seo.astro'
import { isRTL, getFontFamily, getUILabel, getLocalizedPath, DEFAULT_LANGUAGE } from '../lib/i18n'

export interface Props {
  title: string
  description?: string
  lang?: string
  frontmatter?: any
  pageType?: 'article' | 'website'
}

const { 
  title, 
  description = '日本全国の旅ログを多言語で発信するブログ',
  lang = DEFAULT_LANGUAGE,
  frontmatter = { title, description, lang },
  pageType = 'website'
} = Astro.props

const isRightToLeft = isRTL(lang)
const fontFamily = getFontFamily(lang)

// Get current path for hreflang links
const currentPath = Astro.url.pathname
---

<!doctype html>
<html lang={lang} dir={isRightToLeft ? 'rtl' : 'ltr'}>
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content={description} />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <title>{title}</title>
    
    <!-- Comprehensive SEO: Canonical, OG, JSON-LD -->
    <Seo 
      frontmatter={frontmatter} 
      pathname={currentPath} 
      lang={lang} 
      pageType={pageType}
    />
    
    <!-- Hreflang links for 20 languages + x-default -->
    <HreflangLinks currentPath={currentPath} />
    
    <!-- Multi-language Font Loading -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&family=Noto+Serif+JP:wght@400;700&family=Shippori+Mincho:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Google AdSense -->
    {import.meta.env.PUBLIC_ADSENSE_CLIENT_ID && (
      <script 
        is:inline 
        async 
        src={`https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=${import.meta.env.PUBLIC_ADSENSE_CLIENT_ID}`}
        crossorigin="anonymous"
      ></script>
    )}
  </head>
  <body 
    class={`min-h-screen bg-white md:bg-[var(--washi-color)] text-ink font-sans relative overflow-x-hidden ${isRightToLeft ? 'rtl-layout' : 'ltr-layout'}`}
    style={`font-family: ${fontFamily}`}
  >
    <!-- Japanese geometric pattern background -->
    <div class="fixed inset-0 -z-10 overflow-hidden pointer-events-none opacity-[0.03]">
      <svg class="absolute w-full h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 120 120">
        <pattern id="japanese-hemp" patternUnits="userSpaceOnUse" width="120" height="120">
          <!-- Asanoha (hemp leaf) pattern -->
          <g stroke="var(--theme-accent)" stroke-width="1" fill="none">
            <!-- Center hexagon -->
            <polygon points="60,20 80,40 80,80 60,100 40,80 40,40" />
            
            <!-- Radiating lines -->
            <line x1="60" y1="20" x2="60" y2="100" />
            <line x1="40" y1="40" x2="80" y2="80" />
            <line x1="80" y1="40" x2="40" y2="80" />
            
            <!-- Corner patterns -->
            <polygon points="0,20 20,40 20,80 0,100 -20,80 -20,40" />
            <polygon points="120,20 140,40 140,80 120,100 100,80 100,40" />
            <polygon points="60,-40 80,-20 80,20 60,40 40,20 40,-20" />
            <polygon points="60,140 80,160 80,200 60,220 40,200 40,160" />
          </g>
        </pattern>
        <rect width="100%" height="100%" fill="url(#japanese-hemp)"/>
      </svg>
    </div>

    <!-- Skip to main content link for accessibility -->
    <a 
      href="#main-content" 
      class="sr-only focus:not-sr-only absolute top-4 left-4 z-[100] px-4 py-2 bg-[var(--theme-accent)] text-white rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--theme-accent)] focus:ring-offset-2"
    >
      {lang === 'en' ? 'Skip to main content' : 'メインコンテンツへスキップ'}
    </a>

    <Navbar lang={lang} />

    <div class="max-w-7xl mx-auto px-4 py-0 relative">
      <main id="main-content" class="w-full">
        <slot />
      </main>
    </div>

    <!-- Enhanced Japanese-style footer -->
    <footer class="relative mt-16 bg-gradient-to-b from-[#f8f6f3] via-[#f5f3f0] to-[#f0ede8] border-t-2 border-[var(--theme-accent)]/20 overflow-hidden">
      <!-- Traditional Japanese cloud pattern background -->
      <div class="absolute inset-0 opacity-[0.08]">
        <svg class="w-full h-full" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 400 200">
          <pattern id="kumo-pattern" patternUnits="userSpaceOnUse" width="400" height="200">
            <!-- Traditional cloud shapes (kumo) -->
            <g fill="var(--theme-accent)">
              <!-- Main cloud -->
              <ellipse cx="100" cy="80" rx="60" ry="20" opacity="0.6"/>
              <ellipse cx="80" cy="75" rx="40" ry="15" opacity="0.7"/>
              <ellipse cx="120" cy="85" rx="35" ry="12" opacity="0.8"/>
              
              <!-- Secondary clouds -->
              <ellipse cx="250" cy="60" rx="45" ry="15" opacity="0.5"/>
              <ellipse cx="280" cy="65" rx="30" ry="10" opacity="0.6"/>
              
              <ellipse cx="350" cy="120" rx="50" ry="18" opacity="0.4"/>
              <ellipse cx="380" cy="125" rx="25" ry="8" opacity="0.7"/>
            </g>
          </pattern>
          <rect width="100%" height="100%" fill="url(#kumo-pattern)"/>
        </svg>
      </div>
      
      <!-- Decorative top border with traditional pattern -->
      <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[var(--theme-accent)] to-transparent"></div>
      <div class="absolute top-1 left-0 right-0 h-px bg-gradient-to-r from-transparent via-[var(--theme-accent)]/40 to-transparent"></div>
      
      <div class="relative max-w-6xl mx-auto px-6 py-12">
        <!-- Main content centered and simplified -->
        <div class="max-w-4xl mx-auto">
          <!-- Brand section with Japanese aesthetics -->
          <div class="space-y-6">
            <!-- Enhanced logo section -->
            <div class="flex items-center justify-center gap-4 mb-8">
              <!-- Traditional circular logo design -->
              <!-- Logo component -->
              <Logo size={64} kanji="旅" withBadge={true} ariaLabel={getUILabel(lang, 'siteTitle')} class="mr-2" />
              
              <div class="space-y-1 text-center">
                <h2 class="text-2xl font-bold text-[#2d3748] font-serif tracking-wide">
                  {getUILabel(lang, 'siteTitle')}
                </h2>
                <p class="text-sm text-[#666] leading-relaxed font-light">
                  {getUILabel(lang, 'siteDescription')}
                </p>
              </div>
            </div>
            
            <!-- Japanese-style description -->
            <div class="bg-white/50 backdrop-blur-sm rounded-lg p-6 border border-[var(--theme-accent)]/10 shadow-sm">
              <p class="text-[#4a5568] leading-relaxed text-sm mb-6 font-light text-center">
                {lang === 'ja' && (
                  <>
                    日本全国の美しい風景、伝統文化、美食体験を世界20言語で発信。
                    <br class="hidden sm:block"/>
                    一期一会の旅の記録をお届けします。
                  </>
                )}
                {lang === 'en' && (
                  <>
                    Sharing Japan's beautiful landscapes, traditional culture, and culinary experiences in 20 languages worldwide.
                    <br class="hidden sm:block"/>
                    Delivering unforgettable travel memories from across Japan.
                  </>
                )}
                {lang !== 'ja' && lang !== 'en' && (
                  <>
                    日本全国の美しい風景、伝統文化、美食体験を世界20言語で発信。
                    <br class="hidden sm:block"/>
                    一期一会の旅の記録をお届けします。
                  </>
                )}
              </p>
              
              <!-- Stats with Japanese design -->
              <div class="grid grid-cols-2 gap-4 max-w-sm mx-auto mb-6">
                <div class="text-center p-3 bg-gradient-to-b from-white to-[#fafafa] rounded-lg border border-gray-200/50">
                  <div class="text-lg font-bold text-[var(--theme-accent)] font-serif">20+</div>
                  <div class="text-xs text-gray-500 font-light">
                    {lang === 'ja' && '言語'}
                    {lang === 'en' && 'Languages'}
                    {lang === 'es' && 'Idiomas'}
                    {lang === 'fr' && 'Langues'}
                    {lang === 'de' && 'Sprachen'}
                    {lang === 'it' && 'Lingue'}
                    {lang === 'pt-br' && 'Idiomas'}
                    {lang === 'ru' && 'Языки'}
                    {lang === 'ko' && '언어'}
                    {lang === 'zh-cn' && '语言'}
                    {lang === 'zh-tw' && '語言'}
                    {lang === 'ar' && 'لغات'}
                    {lang === 'tr' && 'Diller'}
                    {lang === 'th' && 'ภาษา'}
                    {lang === 'nl' && 'Talen'}
                    {lang === 'pl' && 'Języki'}
                    {lang === 'sv' && 'Språk'}
                    {lang === 'da' && 'Sprog'}
                    {lang === 'fi' && 'Kielet'}
                    {lang === 'id' && 'Bahasa'}
                  </div>
                </div>
                <div class="text-center p-3 bg-gradient-to-b from-white to-[#fafafa] rounded-lg border border-gray-200/50">
                  <div class="text-lg font-bold text-[var(--theme-accent)] font-serif">∞</div>
                  <div class="text-xs text-gray-500 font-light">
                    {lang === 'ja' && '体験'}
                    {lang === 'en' && 'Experiences'}
                    {lang === 'es' && 'Experiencias'}
                    {lang === 'fr' && 'Expériences'}
                    {lang === 'de' && 'Erfahrungen'}
                    {lang === 'it' && 'Esperienze'}
                    {lang === 'pt-br' && 'Experiências'}
                    {lang === 'ru' && 'Опыт'}
                    {lang === 'ko' && '경험'}
                    {lang === 'zh-cn' && '体验'}
                    {lang === 'zh-tw' && '體驗'}
                    {lang === 'ar' && 'تجارب'}
                    {lang === 'tr' && 'Deneyimler'}
                    {lang === 'th' && 'ประสบการณ์'}
                    {lang === 'nl' && 'Ervaringen'}
                    {lang === 'pl' && 'Doświadczenia'}
                    {lang === 'sv' && 'Upplevelser'}
                    {lang === 'da' && 'Oplevelser'}
                    {lang === 'fi' && 'Kokemukset'}
                    {lang === 'id' && 'Pengalaman'}
                  </div>
                </div>
              </div>
              
              <!-- Social Media Links -->
              <div class="flex justify-center gap-4">
                <button 
                  disabled
                  class="w-10 h-10 bg-gradient-to-b from-white to-[#fafafa] rounded-full border border-gray-200/50 flex items-center justify-center text-gray-300 cursor-not-allowed"
                  title="X (Twitter) - 準備中"
                  aria-label="X (Twitter) - 準備中"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                  </svg>
                </button>
                <button 
                  disabled
                  class="w-10 h-10 bg-gradient-to-b from-white to-[#fafafa] rounded-full border border-gray-200/50 flex items-center justify-center text-gray-300 cursor-not-allowed"
                  title="Instagram - 準備中"
                  aria-label="Instagram - 準備中"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
                  </svg>
                </button>
                <button 
                  disabled
                  class="w-10 h-10 bg-gradient-to-b from-white to-[#fafafa] rounded-full border border-gray-200/50 flex items-center justify-center text-gray-300 cursor-not-allowed"
                  title="YouTube - 準備中"
                  aria-label="YouTube - 準備中"
                >
                  <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"/>
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </div>
        
        <!-- Bottom section with traditional separator -->
        <div class="border-t border-[var(--theme-accent)]/20 pt-6 mt-8">
          <!-- Decorative separator -->
          <div class="flex items-center justify-center mb-6">
            <div class="flex-1 h-px bg-gradient-to-r from-transparent via-[var(--theme-accent)]/20 to-[var(--theme-accent)]/20"></div>
            <div class="px-4 text-[var(--theme-accent)] text-sm">❀</div>
            <div class="flex-1 h-px bg-gradient-to-l from-transparent via-[var(--theme-accent)]/20 to-[var(--theme-accent)]/20"></div>
          </div>
          
          <!-- Copyright and links -->
          <div class="text-center space-y-4">
            <div class="flex flex-col sm:flex-row sm:flex-wrap justify-center items-center gap-2 sm:gap-3 text-xs text-[#666]">
              <span class="font-light">&copy; 2025 {getUILabel(lang, 'siteTitle')}</span>
              <div class="flex items-center gap-3">
                <span class="text-[var(--theme-accent)] hidden sm:inline">•</span>
                <a href="/privacy" class="hover:text-[var(--theme-accent)] transition-colors font-light underline decoration-1 underline-offset-2">
                  プライバシーポリシー
                </a>
                <span class="text-[var(--theme-accent)]">•</span>
                <a href="/en/privacy" class="hover:text-[var(--theme-accent)] transition-colors font-light underline decoration-1 underline-offset-2">
                  Privacy Policy
                </a>
              </div>
            </div>
            
            <!-- Final tagline with elegant typography -->
            <p class="text-xs text-[#888] font-light italic px-4 max-w-md mx-auto leading-relaxed">
              {lang === 'ja' && '― 心に残る旅の記録を、世界へ ―'}
              {lang === 'en' && '― Sharing unforgettable travel memories with the world ―'}
              {lang === 'es' && '― Compartiendo memorias de viaje inolvidables con el mundo ―'}
              {lang === 'fr' && '― Partager des souvenirs de voyage inoubliables avec le monde ―'}
              {lang === 'de' && '― Unvergessliche Reiseerinnerungen mit der Welt teilen ―'}
              {lang === 'it' && '― Condividere ricordi di viaggio indimenticabili con il mondo ―'}
              {lang === 'pt-br' && '― Compartilhando memórias de viagem inesquecíveis com o mundo ―'}
              {lang === 'ru' && '― Делимся незабываемыми воспоминаниями о путешествиях с миром ―'}
              {lang === 'ko' && '― 잊을 수 없는 여행의 기억을 세계와 함께 ―'}
              {lang === 'zh-cn' && '― 与世界分享难忘的旅行回忆 ―'}
              {lang === 'zh-tw' && '― 與世界分享難忘的旅行回憶 ―'}
              {lang === 'ar' && '― مشاركة ذكريات سفر لا تُنسى مع العالم ―'}
              {lang === 'tr' && '― Unutulmaz seyahat anılarını dünyayla paylaşmak ―'}
              {lang === 'th' && '― แบ่งปันความทรงจำการเดินทางที่น่าจดจำกับโลก ―'}
              {lang === 'nl' && '― Onvergetelijke reisherinneringen delen met de wereld ―'}
              {lang === 'pl' && '― Dzielenie się niezapomnianymi wspomnieniami z podróży ze światem ―'}
              {lang === 'sv' && '― Dela oförglömliga reseminnen med världen ―'}
              {lang === 'da' && '― Deling af uforglemmelige rejseminder med verden ―'}
              {lang === 'fi' && '― Jakamassa unohtumattomia matkamuistoja maailman kanssa ―'}
              {lang === 'id' && '― Berbagi kenangan perjalanan yang tak terlupakan dengan dunia ―'}
            </p>
          </div>
        </div>
      </div>
      
      <!-- Subtle bottom gradient -->
      <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-[var(--theme-accent)]/10 to-transparent"></div>
    </footer>

    <!-- Professional animations and interactions -->
    <style>
      @keyframes pulse-slow {
        0%, 100% { opacity: 0.8; transform: scale(1); }
        50% { opacity: 0.6; transform: scale(1.05); }
      }
      
      @keyframes spin-slow {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      .animate-pulse-slow {
        animation: pulse-slow 8s ease-in-out infinite;
      }
      
      .animate-spin-slow {
        animation: spin-slow 60s linear infinite;
      }
      
      /* Smooth scrolling */
      html {
        scroll-behavior: smooth;
      }
      
      /* Professional typography */
      body {
        text-rendering: optimizeLegibility;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
      }
    </style>
    
    <!-- Vercel Analytics & Speed Insights -->
    <script>
      // Vercel Analytics
      import('@vercel/analytics').then(module => {
        if (module.inject) {
          module.inject();
        }
      });

      // Vercel Speed Insights  
      import('@vercel/speed-insights').then(module => {
        if (module.injectSpeedInsights) {
          module.injectSpeedInsights();
        }
      });
    </script>

  </body>
</html>