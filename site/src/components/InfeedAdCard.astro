---
import { getUILabel, DEFAULT_LANGUAGE } from '../lib/i18n'

export interface Props {
  slotId: string
  lang?: string
  format?: 'rectangle' | 'banner'
  reserveHeight?: number
  class?: string
}

const { 
  slotId,
  lang = DEFAULT_LANGUAGE,
  format = 'rectangle',
  reserveHeight = 120,
  class: className = ''
} = Astro.props

const adLabel = getUILabel(lang, 'advertisement')
---

<div class={`rounded-xl border border-dashed p-3 mb-4 bg-[var(--theme-accent-fade)] border-[var(--theme-accent)]/20 ${className}`}>
  <!-- Ad Label -->
  <div class="flex justify-center mb-2">
    <span class="text-[10px] text-neutral-500 font-medium">{adLabel}</span>
  </div>
  
  <!-- Ad Content Container -->
  <div 
    class="w-full flex items-center justify-center"
    style={`min-height: ${reserveHeight}px;`}
  >
    <!-- Google AdSense -->
    {import.meta.env.PUBLIC_ADSENSE_CLIENT_ID && (
      <ins
        class="adsbygoogle block w-full"
        data-ad-client={import.meta.env.PUBLIC_ADSENSE_CLIENT_ID}
        data-ad-slot={slotId}
        data-ad-format={format}
        data-full-width-responsive="true"
      ></ins>
    )}
    
    <!-- Fallback placeholder when no ads configured -->
    {!import.meta.env.PUBLIC_ADSENSE_CLIENT_ID && (
      <div class="w-full h-full flex items-center justify-center bg-[var(--theme-accent-weak)] rounded-lg text-[var(--theme-accent)]/70 text-sm">
        {adLabel}
      </div>
    )}
  </div>
</div>

{import.meta.env.PUBLIC_ADSENSE_CLIENT_ID && (
  <script>
    // Initialize Google AdSense ads
    if (typeof (adsbygoogle) !== 'undefined') {
      (adsbygoogle || []).push({});
    }
  </script>
)}

<style>
  /* Ensure ads don't break layout */
  .adsbygoogle {
    display: block !important;
  }
  
  /* Subtle animation for ad container */
  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }
  
  .adsbygoogle {
    animation: fadeIn 0.5s ease-in-out;
  }
</style>