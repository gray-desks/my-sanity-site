---
import type { Article } from '../lib/sanity'

interface Props {
  article: Article
  lang: string
}

const { article, lang } = Astro.props

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString(lang === 'ja' ? 'ja-JP' : 'en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

const typeLabels = {
  ja: {
    spot: 'ã‚¹ãƒãƒƒãƒˆ',
    food: 'é£Ÿäº‹',
    transport: 'äº¤é€š',
    hotel: 'ãƒ›ãƒ†ãƒ«',
    note: 'ãƒ¡ãƒ¢'
  },
  en: {
    spot: 'Spot',
    food: 'Food',
    transport: 'Transport',
    hotel: 'Hotel',
    note: 'Note'
  }
}

const typeIcons = {
  spot: 'ğŸ“',
  food: 'ğŸ½ï¸',
  transport: 'ğŸš…',
  hotel: 'ğŸ¨',
  note: 'ğŸ“'
}

const labels = typeLabels[lang as keyof typeof typeLabels] || typeLabels.ja
const articleUrl = lang === 'en' 
  ? `/en/${article.type}/${article.slug?.current}` 
  : `/${article.type}/${article.slug?.current}`
---

<article class="bg-white rounded-lg shadow hover:shadow-lg transition-shadow">
  {article.coverImage?.asset?.url && (
    <img 
      src={article.coverImage.asset.url}
      alt={article.title}
      class="w-full h-48 object-cover rounded-t-lg"
    />
  )}
  
  <div class="p-6">
    <!-- Type Badge -->
    <div class="flex items-center gap-2 mb-3">
      <span class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm font-medium">
        {typeIcons[article.type as keyof typeof typeIcons]} {labels[article.type as keyof typeof labels]}
      </span>
      {article.placeName && (
        <span class="text-gray-600 text-sm">ğŸ“ {article.placeName}</span>
      )}
    </div>

    <!-- Title -->
    <h3 class="text-xl font-semibold mb-2 hover:text-blue-600">
      <a href={articleUrl}>
        {article.title}
      </a>
    </h3>
    
    <!-- Date -->
    <div class="flex justify-between items-center text-sm text-gray-500 mb-4">
      <time datetime={article.publishedAt}>
        {formatDate(article.publishedAt)}
      </time>
    </div>

    <!-- Gallery preview -->
    {article.gallery && article.gallery.length > 0 && (
      <div class="mb-3">
        <div class="flex gap-1 overflow-x-auto">
          {article.gallery.slice(0, 3).map((image) => (
            image.asset?.url && (
              <img 
                src={image.asset.url}
                alt=""
                class="w-16 h-16 object-cover rounded flex-shrink-0"
              />
            )
          ))}
          {article.gallery.length > 3 && (
            <div class="w-16 h-16 bg-gray-100 rounded flex items-center justify-center text-gray-500 text-xs flex-shrink-0">
              +{article.gallery.length - 3}
            </div>
          )}
        </div>
      </div>
    )}

    <!-- Location info -->
    {article.location && (
      <div class="mt-3 text-xs text-gray-500 flex items-center gap-1">
        <span>ğŸ—ºï¸</span>
        <span>
          {lang === 'ja' ? 'ä½ç½®æƒ…å ±ã‚ã‚Š' : 'Location available'}
        </span>
      </div>
    )}
  </div>
</article>