---
import type { Article } from '../lib/sanity'

interface Props {
  article: Article
  lang: string
}

const { article, lang } = Astro.props

const formatDate = (dateString: string) => {
  return new Date(dateString).toLocaleDateString(lang === 'ja' ? 'ja-JP' : 'en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric'
  })
}

const typeConfig = {
  spot: {
    emoji: 'üóæ',
    label: { ja: '„Çπ„Éù„ÉÉ„Éà', en: 'Spot' },
    colors: 'bg-brand-100 text-brand-700'
  },
  food: {
    emoji: 'üç£',
    label: { ja: '„Ç∞„É´„É°', en: 'Food' },
    colors: 'bg-secondary-100 text-secondary-700'
  },
  transport: {
    emoji: 'üöÑ',
    label: { ja: '‰∫§ÈÄö', en: 'Transport' },
    colors: 'bg-accent-100 text-accent-700'
  },
  hotel: {
    emoji: 'üõèÔ∏è',
    label: { ja: 'ÂÆøÊ≥ä', en: 'Hotel' },
    colors: 'bg-purple-100 text-purple-700'
  },
  note: {
    emoji: 'üìù',
    label: { ja: '„É°„É¢', en: 'Note' },
    colors: 'bg-gray-100 text-gray-700'
  }
}

const config = typeConfig[article.type as keyof typeof typeConfig] || typeConfig.note
const typeLabel = config.label[lang as keyof typeof config.label] || config.label.ja

const articleUrl = lang === 'en' 
  ? `/en/${article.type}/${article.slug?.current}` 
  : `/${article.type}/${article.slug?.current}`
---

<a 
  href={articleUrl} 
  class="block break-inside-avoid mb-6 bg-gradient-card backdrop-blur-md rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-200 overflow-hidden group border border-white/30 hover:border-brand-300/60 hover:-translate-y-3 hover:scale-[1.02] relative animate-fade-in"
  data-article
  data-title={article.title}
  data-type={article.type}
  data-place-name={article.placeName || ''}
  data-prefecture={article.prefecture || ''}
  data-body-text={article.bodyText || ''}
>
  <!-- Shimmer effect overlay -->
  <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/10 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-300 ease-out pointer-events-none"></div>
  
  <!-- Glow effect -->
  <div class="absolute inset-0 rounded-3xl opacity-0 group-hover:opacity-100 transition-opacity duration-200 bg-gradient-to-r from-primary-500/20 via-accent-500/20 to-sunset-500/20 blur-md -z-10 pointer-events-none"></div>
  
  {article.coverImage?.asset?.url && (
    <div class="relative overflow-hidden rounded-t-3xl">
      <img 
        src={`${article.coverImage.asset.url}?w=600&h=450&fit=crop&auto=format`}
        alt={article.title}
        class="w-full aspect-[4/3] object-cover group-hover:scale-110 transition-transform duration-300 ease-out"
        loading="lazy"
        decoding="async"
      />
      <!-- Multiple overlay effects -->
      <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-black/10 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-200 pointer-events-none"></div>
      <div class="absolute inset-0 bg-gradient-to-br from-primary-500/20 to-accent-500/20 opacity-0 group-hover:opacity-60 transition-opacity duration-300 pointer-events-none"></div>
      
      <!-- Floating badge on hover -->
      <div class="absolute top-4 left-4 opacity-0 group-hover:opacity-100 transition-all duration-200 transform translate-y-2 group-hover:translate-y-0 pointer-events-none">
        <div class="px-3 py-1 bg-white/90 backdrop-blur-sm rounded-full text-xs font-semibold text-primary-600 shadow-lg">
          {lang === 'ja' ? 'Ë®ò‰∫ã„ÇíË™≠„ÇÄ' : 'Read More'}
        </div>
      </div>
    </div>
  )}
  
  <div class="p-6 relative">
    <!-- Type Badge and Location -->
    <div class="flex items-center justify-between gap-2 mb-4">
      <span class={`inline-flex items-center px-4 py-2.5 rounded-2xl text-sm font-bold transition-all duration-300 group-hover:scale-110 group-hover:rotate-1 ${config.colors} shadow-lg hover:shadow-xl backdrop-blur-sm border border-white/20`}>
        <span class="mr-2 text-base">{config.emoji}</span>
        {typeLabel}
      </span>
      {article.placeName && (
        <div class="flex items-center text-gray-500 text-sm text-gray-500 text-sm">
          <svg class="w-4 h-4 mr-1 group-hover:animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
          </svg>
          <span class="font-medium">{article.placeName}</span>
        </div>
      )}
    </div>

    <!-- Title with enhanced typography -->
    <h3 class="text-xl font-bold mb-3 text-gray-900 group-hover:text-transparent group-hover:bg-clip-text group-hover:bg-gradient-to-r group-hover:from-brand-600 group-hover:to-accent-600 transition-all duration-200 leading-tight hover:translate-x-1">
      {article.title}
    </h3>
    
    <!-- Date -->
    <div class="text-sm text-gray-500 mb-4 flex items-center">
      <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
      </svg>
      <time datetime={article.publishedAt}>
        {formatDate(article.publishedAt)}
      </time>
    </div>

    <!-- Enhanced Gallery preview -->
    {article.gallery && article.gallery.length > 0 && (
      <div class="mb-4">
        <div class="flex gap-3 overflow-x-auto pb-2">
          {article.gallery.slice(0, 4).map((image, index) => (
            image.asset?.url && (
              <div class="relative group/gallery">
                <img 
                  src={`${image.asset.url}?w=56&h=56&fit=crop&auto=format`}
                  alt=""
                  class="w-14 h-14 object-cover rounded-xl flex-shrink-0 ring-2 ring-white/50 shadow-lg hover:ring-brand-400 hover:scale-110 transition-all duration-300 hover:shadow-xl"
                  loading="lazy"
                  decoding="async"
                  style={`--animation-delay: ${index * 100}ms; animation-delay: var(--animation-delay);`}
                />
                <div class="absolute inset-0 bg-gradient-to-t from-brand-500/20 to-transparent opacity-0 group-hover/gallery:opacity-100 transition-opacity duration-300 rounded-xl"></div>
              </div>
            )
          ))}
          {article.gallery.length > 4 && (
            <div class="w-14 h-14 bg-gradient-to-br from-gray-100 to-gray-200 rounded-xl flex items-center justify-center text-gray-600 text-xs font-bold flex-shrink-0 ring-2 ring-white/50 shadow-lg hover:scale-110 transition-all duration-300 hover:shadow-xl cursor-pointer">
              <span class="text-xs">+{article.gallery.length - 4}</span>
            </div>
          )}
        </div>
      </div>
    )}

    
  </div>
</a>