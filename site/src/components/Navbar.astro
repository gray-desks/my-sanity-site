---
import { getUILabel, getLocalizedPath, ENABLED_LANGUAGES, ALL_LANGUAGES, DEFAULT_LANGUAGE } from '../lib/i18n'

export interface Props {
  lang?: string
}

const { lang = DEFAULT_LANGUAGE } = Astro.props

// å°†æ¥ã®å¤šè¨€èªå±•é–‹ç”¨ã®è¨€èªåˆ¥ãƒ•ãƒ©ã‚°ã‚¨ãƒ¢ã‚¸
const languageFlags = {
  ja: 'ğŸ‡¯ğŸ‡µ',
  en: 'ğŸ‡ºğŸ‡¸',
  'zh-cn': 'ğŸ‡¨ğŸ‡³',
  'zh-tw': 'ğŸ‡¹ğŸ‡¼',
  ko: 'ğŸ‡°ğŸ‡·',
  th: 'ğŸ‡¹ğŸ‡­',
  vi: 'ğŸ‡»ğŸ‡³',
  id: 'ğŸ‡®ğŸ‡©',
  ms: 'ğŸ‡²ğŸ‡¾',
  tl: 'ğŸ‡µğŸ‡­',
  fr: 'ğŸ‡«ğŸ‡·',
  de: 'ğŸ‡©ğŸ‡ª',
  es: 'ğŸ‡ªğŸ‡¸',
  it: 'ğŸ‡®ğŸ‡¹',
  pt: 'ğŸ‡µğŸ‡¹',
  ru: 'ğŸ‡·ğŸ‡º',
  ar: 'ğŸ‡¸ğŸ‡¦',
  hi: 'ğŸ‡®ğŸ‡³',
  tr: 'ğŸ‡¹ğŸ‡·',
  'pt-br': 'ğŸ‡§ğŸ‡·'
} as const

// å…¨æœ‰åŠ¹è¨€èªã‚’è¡¨ç¤ºï¼ˆ20è¨€èªï¼‰
const availableLanguages = ENABLED_LANGUAGES
---

<nav class="sticky top-0 z-50 bg-base/80 backdrop-blur-md border-b border-border">
  <div class="max-w-7xl mx-auto px-4 py-3 sm:py-4 flex items-center justify-between">
    <!-- Logo -->
    <a href={lang === 'ja' ? '/' : `/${lang}/`} class="flex items-center gap-3 group">
      <div class="w-10 h-10 bg-primary rounded-lg flex items-center justify-center group-hover:scale-110 transition-transform">
        <span class="text-white font-bold text-lg">æ—…</span>
      </div>
      <span class="text-2xl font-bold text-ink">
        {getUILabel(lang, 'siteTitle')}
      </span>
    </a>
    
    <!-- Navigation Links -->
    <div class="flex items-center gap-4">
      
      <!-- ãƒ¢ãƒã‚¤ãƒ«ç”¨è¨€èªãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
      <details class="sm:hidden relative">
        <summary class="flex items-center gap-1 px-3 h-10 rounded-lg bg-ink/5 text-ink focus:ring-2 focus:ring-primary cursor-pointer">
          ğŸŒ
        </summary>
        <div class="absolute right-0 mt-2 w-48 bg-base rounded-lg shadow-lg border border-ink/10 z-50 max-h-80 overflow-y-auto">
          {availableLanguages.map((language) => (
            <a
              href={language.id === 'ja' ? '/' : `/${language.id}/`}
              class={`block px-4 py-2 text-sm hover:bg-primary/10 transition-colors ${
                language.id === lang ? 'font-semibold text-primary bg-primary/5' : 'text-secondary'
              }`}}
              title={language.nativeName}
            >
              <span class="mr-2">{languageFlags[language.id as keyof typeof languageFlags] || 'ğŸŒ'}</span>
              {language.nativeName}
            </a>
          ))}
        </div>
      </details>

      <!-- ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç”¨è¨€èªãƒœã‚¿ãƒ³ï¼ˆ2æ®µè¡¨ç¤ºï¼‰ -->
      <div class="hidden sm:flex flex-col gap-1">
        <!-- 1æ®µç›®: 10è¨€èª -->
        <div class="flex items-center gap-1">
          {availableLanguages.slice(0, 10).map((language) => {
              const isCurrentLang = language.id === lang
              
              // è¨€èªé¸æŠæ™‚ã¯å¸¸ã«ãƒˆãƒƒãƒ—ç”»é¢ã«é·ç§»
              function generateLanguageUrl(targetLang: string): string {
                if (targetLang === 'ja') {
                  return '/'
                } else {
                  return `/${targetLang}/`
                }
              }
              
              const cleanPath = generateLanguageUrl(language.id)
              
              return (
                <a
                  href={cleanPath}
                  aria-label={`Switch to ${language.nativeName}`}
                  class={`
                     inline-flex items-center justify-center w-14 h-8 rounded-lg transition-all duration-200 ease-out focus:ring-2 focus:ring-primary focus:outline-none shrink-0
                     ${isCurrentLang 
                      ? 'bg-primary text-white shadow-md' 
                      : 'bg-ink/5 text-ink hover:bg-primary/10 hover:text-primary'
                    }
                  `}
                  title={language.nativeName}
                >
                  
                  <div class="flex items-center gap-1">
                    <!-- Flag Icon -->
                    <span class="text-xs">
                      {languageFlags[language.id as keyof typeof languageFlags] || 'ğŸŒ'}
                    </span>
                    
                    <!-- Language Text -->
                    <span class="text-xs font-medium">
                      {language.shortName}
                    </span>
                  </div>
                  
                </a>
              )
            })}
        </div>
        
        <!-- 2æ®µç›®: æ®‹ã‚Š10è¨€èª -->
        <div class="flex items-center gap-1">
          {availableLanguages.slice(10).map((language) => {
              const isCurrentLang = language.id === lang
              
              // è¨€èªé¸æŠæ™‚ã¯å¸¸ã«ãƒˆãƒƒãƒ—ç”»é¢ã«é·ç§»
              function generateLanguageUrl(targetLang: string): string {
                if (targetLang === 'ja') {
                  return '/'
                } else {
                  return `/${targetLang}/`
                }
              }
              
              const cleanPath = generateLanguageUrl(language.id)
              
              return (
                <a
                  href={cleanPath}
                  aria-label={`Switch to ${language.nativeName}`}
                  class={`
                     inline-flex items-center justify-center w-14 h-8 rounded-lg transition-all duration-200 ease-out focus:ring-2 focus:ring-primary focus:outline-none shrink-0
                     ${isCurrentLang 
                      ? 'bg-primary text-white shadow-md' 
                      : 'bg-ink/5 text-ink hover:bg-primary/10 hover:text-primary'
                    }
                  `}
                  title={language.nativeName}
                >
                  
                  <div class="flex items-center gap-1">
                    <!-- Flag Icon -->
                    <span class="text-xs">
                      {languageFlags[language.id as keyof typeof languageFlags] || 'ğŸŒ'}
                    </span>
                    
                    <!-- Language Text -->
                    <span class="text-xs font-medium">
                      {language.shortName}
                    </span>
                  </div>
                  
                </a>
              )
            })}
        </div>
      </div>
    </div>
  </div>
</nav>